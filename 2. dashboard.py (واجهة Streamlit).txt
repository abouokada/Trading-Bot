# dashboard.py
import sqlite3
import pandas as pd
import streamlit as st

# Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
conn = sqlite3.connect('trading_bot.db', check_same_thread=False)
st.set_page_config(page_title="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨ÙˆØª", layout="wide")

st.title("ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¨ÙˆØª Ø§Ù„ØªØ¯Ø§ÙˆÙ„")

# Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
status = st.radio("ğŸ”˜ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª:", ["âœ… ÙŠØ¹Ù…Ù„", "â›”ï¸ Ù…ØªÙˆÙ‚Ù"])
st.info("Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ Ù†Ø±Ø¨Ø·Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ÙÙ„Ø§Øº Ø§Ù„ØªØ´ØºÙŠÙ„.")

# Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙ‚Ø§Øª
df = pd.read_sql_query("SELECT * FROM trades ORDER BY timestamp DESC", conn)

st.subheader("ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„ØµÙÙ‚Ø§Øª")
st.dataframe(df)

# Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©
st.subheader("ğŸ“ˆ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª")
win_count = df[df['result'] == 'WIN'].shape[0]
loss_count = df[df['result'] == 'LOSS'].shape[0]
st.metric("âœ… ØµÙÙ‚Ø§Øª Ø±Ø§Ø¨Ø­Ø©", win_count)
st.metric("âŒ ØµÙÙ‚Ø§Øª Ø®Ø§Ø³Ø±Ø©", loss_count)

# Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­
df['timestamp'] = pd.to_datetime(df['timestamp'])
df['P&L'] = df['exit_price'] - df['entry_price']
df['Cumulative P&L'] = df['P&L'].cumsum()
st.line_chart(df.set_index('timestamp')['Cumulative P&L'])
